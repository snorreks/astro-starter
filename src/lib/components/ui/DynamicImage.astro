---
// src/lib/components/ui/DynamicImage.astro
import type { ImageMetadata } from 'astro';
import type { ComponentProps } from 'astro/types';

import Picture from '$components/ui/Picture.astro';
import { Picture as PictureComponent } from 'astro:assets';

/**
 * A component to dynamically import and display images from the assets folder.
 * It uses the Astro `Picture` component to serve optimized images.
 */
type Props = ComponentProps<typeof PictureComponent> & {
  /**
   * The alt text for the image. Required.
   */
  alt: string;

  /**
   * The path to the image within the `src/assets` directory. Required.
   */
  src: string;
};

const { class: className, src, ...attrs } = Astro.props;

// Import all images dynamically
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/**/*.{jpeg,jpg,png,gif,webp,avif,svg}',
);

// Construct the full path from the src
const fullPath = `/src/assets/${src}`;

// Check if the image exists in our glob
if (!images[fullPath]) {
  throw new Error(
    `"${fullPath}" does not exist in glob: "/src/assets/**/*.{jpeg,jpg,png,gif,webp,avif,svg}"`,
  );
}
---

<Picture src={(await images[fullPath]()).default} class={className} {...attrs} />
