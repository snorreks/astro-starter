---
// src/lib/components/base/Analytics.astro
//
// https://daniel.es/blog/the-ultimate-astro-google-analytics-guide/
/**
 * Integrates Google Analytics into the site.
 * It includes the gtag.js script and configures it to be GDPR compliant.
 */
type Props = {
  /** The Google Analytics measurement ID. Required. */
  id: string;
};

const { id } = Astro.props;
const url = `https://www.googletagmanager.com/gtag/js?id=${id}`;
---

<!-- Google tag (gtag.js) -->
<script src={url} type="text/partytown" is:inline></script>
<script type="text/partytown" is:inline>
  globalThis.dataLayer = globalThis.dataLayer || [];
  const gtag = (...args) => {
    dataLayer.push(args);
  };

  gtag('js', new Date());

  // To be GDPR complaint and also not to give the users annoying banners we make all users anonymous
  gtag('consent', 'default', {
    ad_storage: 'denied',
    ad_user_data: 'denied',
    ad_personalization: 'denied',
    analytics_storage: 'denied',
  });

  gtag('config', id);
</script>
