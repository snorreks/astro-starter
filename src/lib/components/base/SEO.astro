---
import { languages } from '$data/i18n'
import { site } from '$data/site-content'
// src/lib/components/base/SEO.astro
// src/lib/components/base/SEO.astro
import { AstroSEO } from 'astro-seo-plugin'

/**
 * SEO Component
 *
 * @description Component to handle site metadata and essential head elements
 */
type Props = {
  /**
   * The description of the page
   */
  description: string
  /**
   * The image path for social sharing
   */
  image: string

  /**
   * The title of the page
   */
  title: string
}

const { title, description, image = '/social_preview_image.png' } = Astro.props

// 1. URL & Image Logic
const siteUrl = Astro.site?.toString() ?? site.url
const cleanImage = image.startsWith('/') ? image.slice(1) : image
const fullImageUrl = new URL(cleanImage, siteUrl).toString()
const canonicalURL = new URL(Astro.url.pathname, siteUrl).toString()

// 2. i18n & Slug Logic
const currentPath = Astro.url.pathname
const currentLang = Astro.currentLocale || 'en'
// Remove the current language prefix to get the clean slug
const cleanSlug = currentPath.replace(new RegExp(`^/${currentLang}`), '') || '/'

// 3. Generate Hreflangs
const alternateLinks = [
  ...Object.values(languages).map((lang) => ({
    rel: 'alternate',
    hreflang: lang.code,
    href: `${siteUrl}${lang.code}${cleanSlug === '/' ? '' : cleanSlug}`,
  })),
  {
    rel: 'alternate',
    hreflang: 'x-default',
    href: `${siteUrl}en${cleanSlug === '/' ? '' : cleanSlug}`,
  },
]

// 4. Favicons
const favicons = [
  { rel: 'icon', href: '/favicon.ico', sizes: 'any' },
  { rel: 'icon', href: '/favicon.svg', type: 'image/svg+xml' },
  { rel: 'icon', href: '/android-chrome-192x192.png', type: 'image/png', sizes: '192x192' },
  { rel: 'icon', href: '/favicon-32x32.png', type: 'image/png', sizes: '32x32' },
  { rel: 'icon', href: '/favicon-16x16.png', type: 'image/png', sizes: '16x16' },
  { rel: 'apple-touch-icon', href: '/apple-touch-icon.png' },
  { rel: 'manifest', href: '/site.webmanifest' },
]
---

<AstroSEO
  title={title}
  additionalLinkTags={[...favicons, ...alternateLinks]}
  additionalMetaTags={[
    { name: 'viewport', content: 'width=device-width, initial-scale=1' },
    { name: 'theme-color', content: site.themeColor },
    { name: 'generator', content: Astro.generator },
    { name: 'author', content: site.author },
    {
      name: 'keywords',
      content: site.keywords.join(', '),
    },
  ]}
  canonical={canonicalURL}
  description={description}
  jsonLd={{
    '@context': 'https://schema.org',
    '@type': 'Organization',
    name: site.name,
    image: fullImageUrl,
    description: description,
    url: siteUrl,
    telephone: site.telephone,
    founder: {
      '@type': 'Person',
      name: site.author,
    },
    address: {
      '@type': 'PostalAddress',
      addressLocality: site.address.locality,
      addressCountry: site.address.country,
    },
    priceRange: site.priceRange,
    sameAs: [site.social.instagram, site.social.youtube],
  }}
  openGraph={{
    title: title,
    description: description,
    url: canonicalURL,
    type: 'website',
    image: fullImageUrl,
    siteName: site.name,
    locale: currentLang,
  }}
  robots={{
    index: true,
    follow: true,
  }}
  twitter={{
    card: 'summary_large_image',
    site: site.social.twitter,
    title: title,
    description: description,
    image: fullImageUrl,
  }}
/>
